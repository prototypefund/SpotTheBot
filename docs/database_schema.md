### Database Schema (Redis)

**Globals**:
- `user_id_counter`: Counter to generate user IDs
- `snippet_id_counter`: Counter to generate snippet IDs
- `user_name_hashes`: Set containing hashes of user names

**User Entries**:
- `user:<user_id>`: Hash containing details about the user
  - `secret_name_hash`: Hash of the user name
  - `invited_by_user_id`: ID of the user who invited this user (or `-1` if not invited by anyone)
  - `created_at`: Timestamp of user creation
  - `last_positives_rate`: Last rate of positive classifications
  - `last_negatives_rate`: Last rate of negative classifications

- `user:<user_id>:friends`: Set containing IDs of the friends of the user with ID `<user_id>`
- `user:<user_id>:progress`: Hash storing the user's progress
  - `current_seed`: Current random seed value
  - `from_snippet_id`: Start snippet ID in the user's current task
  - `to_snippet_id`: End snippet ID in the user's current task
  - `current_index`: Current index or position of the user

**Snippet Entries**:
- `snippet:<snippet_id>`: Hash containing snippet details
  - `text`: The snippet text
  - `source`: The source of the snippet
  - `is_bot`: A boolean indicating if the snippet is generated by a bot (stored as integer: 1 for True, 0 for False)
  - Additional metadata about the snippet

**Marker Entries**:
- `marker:<marker_name>:<field>`: Key to track various stats about a marker
- `marker:<marker_name>:last_update`: Timestamp of the last update for a marker

### Functions and Database Entries Interaction

**Initialization Functions**:
- `initialize_counters(r)`:
  - Accesses: `user_id_counter`, `snippet_id_counter`

**User Database Functions**:
- `create_user(r, secret_name_hash, invited_by_user_id)`:
  - Accesses: `user_name_hashes`, `user_id_counter`, `user:<user_id>`
- `make_friends(r, user_id, friend_id)`:
  - Accesses: `user:<user_id>:friends`, `user:<friend_id>:friends`
- `remove_friend_unidirectional(r, user_id, friend_id)`:
  - Accesses: `user:<user_id>:friends`
- `delete_user(r, user_id)`:
  - Accesses: `user:<user_id>`, `user:<user_id>:friends`
- `update_user_state(r, user_key, state_update, minimum)`:
  - Accesses: `user:<user_id>`
- `get_friends(r, user_id)`:
  - Accesses: `user:<user_id>:friends`
- `set_user_progress(r, user_key, current_seed, from_snippet_id, to_snippet_id, current_index)`:
  - Accesses: `user:<user_id>:progress`

**Snippet Database Functions**:
- `set_snippet(r, text, source, is_bot, metadata)`:
  - Accesses: `snippet_id_counter`, `snippet:<snippet_id>`
- `get_snippet(r, snippet_id)`:
  - Accesses: `snippet:<snippet_id>`
- `remove_snippet(r, snippet_id)`:
  - Accesses: `snippet:<snippet_id>`

**Marker Database Functions**:
- `increment_marker(r, marker_name, field)`:
  - Accesses: `marker:<marker_name>:<field>`, `marker:<marker_name>:last_update`
- `get_marker_value(r, marker_name, field)`:
  - Accesses: `marker:<marker_name>:<field>`
- `remove_marker(r, marker_name)`:
  - Accesses: `marker:<marker_name>:*`

The provided code implements a simple database schema using Redis to manage users, their friends, and snippets of text. It also manages certain markers that have statistics associated with them. The data is stored in keys structured for users, snippets, and markers respectively, with various fields inside these main categories. The functions provided interact with these keys to perform CRUD operations on the stored data.